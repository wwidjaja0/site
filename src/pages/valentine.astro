---
import BaseLayout from "../layouts/BaseLayout.astro";
---
<BaseLayout title="Valentine">
	<section class="gate" data-locked="true">
		<div class="gate__card" id="gate-card">
			<h1>Locked</h1>
			<p>Enter the passcode to view this page.</p>
			<form id="gate-form" autocomplete="off">
				<input
					id="gate-input"
					name="passcode"
					type="password"
					placeholder="Passcode"
					required
				/>
				<button type="submit">Unlock</button>
			</form>
			<p class="gate__error" id="gate-error" aria-live="polite"></p>
		</div>
	</section>

	<section class="locked-content" id="locked-content" hidden>
		<h1>HAI POOKIE</h1>
		<p>Will you be my valentine?</p>
		<div class="choice">
			<button type="button" id="yes-button">Yes</button>
			<button type="button" id="no-button">No</button>
		</div>
		<p class="no-message" id="no-message" hidden>Nice try.</p>
		<div class="yes-celebration" id="yes-celebration" hidden>
			<p class="yes-celebration__text">YAYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY</p>
			<img
				src="https://media1.tenor.com/m/q6fpGpvQ1TUAAAAd/squid-game-front-man.gif"
				alt="A cute animated gif"
				style="width: 100%; max-width: 300px; margin-top: 1rem;"
			/>
			<div class="confetti" id="confetti" aria-hidden="true"></div>
		</div>
	</section>

	<script is:inline>
		const PASSCODE = "katiesvalentine";
		const STORAGE_KEY = "valentine-unlocked";

		const gate = document.querySelector("[data-locked]");
		const content = document.getElementById("locked-content");
		const form = document.getElementById("gate-form");
		const input = document.getElementById("gate-input");
		const error = document.getElementById("gate-error");
		const yesButton = document.getElementById("yes-button");
		const noButton = document.getElementById("no-button");
		const noMessage = document.getElementById("no-message");
		const celebration = document.getElementById("yes-celebration");
		const confetti = document.getElementById("confetti");
		const choice = document.querySelector(".choice");

		const unlock = () => {
			gate?.setAttribute("data-locked", "false");
			if (content) {
				content.hidden = false;
			}
			gate?.remove();
			localStorage.setItem(STORAGE_KEY, "true");
		};

		const isUnlocked = () => localStorage.getItem(STORAGE_KEY) === "true";

		if (isUnlocked()) {
			unlock();
		}

		form?.addEventListener("submit", (event) => {
			event.preventDefault();
			if (!input) {
				return;
			}
			if (input.value === PASSCODE) {
				unlock();
				return;
			}
			if (error) {
				error.textContent = "Incorrect passcode.";
			}
			input.value = "";
			input.focus();
		});

		noButton?.addEventListener("click", () => {
			noButton.remove();
			if (noMessage) {
				noMessage.hidden = false;
			}
		});

		const launchConfetti = () => {
			if (!confetti) {
				return;
			}
			const colors = ["#ffe263", "#a2ffb2", "#7ad7ff", "#ff9ad5", "#ffd166"];
			confetti.innerHTML = "";
			for (let i = 0; i < 28; i += 1) {
				const piece = document.createElement("span");
				piece.className = "confetti__piece";
				piece.style.setProperty("--left", `${Math.random() * 100}%`);
				piece.style.setProperty("--delay", `${Math.random() * 0.6}s`);
				piece.style.setProperty("--duration", `${1.6 + Math.random() * 1.2}s`);
				piece.style.setProperty("--size", `${6 + Math.random() * 6}px`);
				piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
				confetti.appendChild(piece);
			}
		};

		yesButton?.addEventListener("click", () => {
			choice?.setAttribute("hidden", "");
			if (celebration) {
				celebration.hidden = false;
			}
			launchConfetti();
		});
	</script>

	<style>
		.gate {
			display: grid;
			place-items: center;
			min-height: 60vh;
		}

		.gate__card {
			width: min(28rem, 100%);
			border: 1px solid var(--primary-color, #00ffff);
			padding: 1.5rem;
			box-shadow: var(--shadow, 0 0 0 transparent);
		}

		.gate__card h1 {
			margin-bottom: 0.75rem;
		}

		.gate__card form {
			display: grid;
			gap: 0.75rem;
			margin-top: 1rem;
		}

		.gate__card input {
			padding: 0.5rem;
			border: 1px solid var(--primary-color, #00ffff);
			background: transparent;
			color: var(--text-color, #ffffff);
		}

		.gate__card button {
			padding: 0.5rem 0.75rem;
			border: 1px solid var(--primary-color, #00ffff);
			background: transparent;
			color: var(--text-color, #ffffff);
			cursor: pointer;
		}

		.gate__error {
			min-height: 1.5rem;
			color: var(--accent-color, #ffe263);
		}

		.choice {
			display: flex;
			gap: 0.75rem;
			margin-top: 1rem;
			flex-wrap: wrap;
		}

		.choice button {
			padding: 0.5rem 0.75rem;
			border: 1px solid var(--primary-color, #00ffff);
			background: transparent;
			color: var(--text-color, #ffffff);
			cursor: pointer;
		}

		.no-message {
			margin-top: 0.75rem;
			color: var(--accent-color, #ffe263);
		}

		.yes-celebration {
			margin-top: 1.25rem;
		}

		.yes-celebration__text {
			font-size: 1.4rem;
			text-transform: uppercase;
			letter-spacing: 0.08em;
			animation: pop 0.6s ease-out both;
		}

		.confetti {
			position: relative;
			height: 140px;
			overflow: hidden;
			margin-top: 0.5rem;
		}

		.confetti__piece {
			position: absolute;
			left: var(--left);
			top: -20px;
			width: var(--size);
			height: var(--size);
			opacity: 0;
			animation: fall var(--duration) ease-in var(--delay) forwards;
		}

		@keyframes pop {
			0% {
				transform: scale(0.85);
				opacity: 0;
			}
			100% {
				transform: scale(1);
				opacity: 1;
			}
		}

		@keyframes fall {
			0% {
				transform: translateY(0) rotate(0deg);
				opacity: 1;
			}
			100% {
				transform: translateY(180px) rotate(240deg);
				opacity: 0;
			}
		}
	</style>
</BaseLayout>

